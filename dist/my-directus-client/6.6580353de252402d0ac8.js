(window.webpackJsonp=window.webpackJsonp||[]).push([[6],{dB9c:function(t,n,e){"use strict";e.r(n);var o=e("zVF4"),i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)n.hasOwnProperty(e)&&(t[e]=n[e])};function u(t,n){function e(){this.constructor=t}i(t,n),t.prototype=null===n?Object.create(n):(e.prototype=n.prototype,new e)}var s=Object.assign||function(t){for(var n,e=1,o=arguments.length;e<o;e++)for(var i in n=arguments[e])Object.prototype.hasOwnProperty.call(n,i)&&(t[i]=n[i]);return t};function a(t,n,e,o){return new(e||(e=Promise))(function(i,u){function s(t){try{c(o.next(t))}catch(n){u(n)}}function a(t){try{c(o.throw(t))}catch(n){u(n)}}function c(t){t.done?i(t.value):new e(function(n){n(t.value)}).then(s,a)}c((o=o.apply(t,n||[])).next())})}function c(t,n){var e,o,i,u,s={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return u={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(u[Symbol.iterator]=function(){return this}),u;function a(u){return function(a){return function(u){if(e)throw new TypeError("Generator is already executing.");for(;s;)try{if(e=1,o&&(i=o[2&u[0]?"return":u[0]?"throw":"next"])&&!(i=i.call(o,u[1])).done)return i;switch(o=0,i&&(u=[0,i.value]),u[0]){case 0:case 1:i=u;break;case 4:return s.label++,{value:u[1],done:!1};case 5:s.label++,o=u[1],u=[0];continue;case 7:u=s.ops.pop(),s.trys.pop();continue;default:if(!(i=(i=s.trys).length>0&&i[i.length-1])&&(6===u[0]||2===u[0])){s=0;continue}if(3===u[0]&&(!i||u[1]>i[0]&&u[1]<i[3])){s.label=u[1];break}if(6===u[0]&&s.label<i[1]){s.label=i[1],i=u;break}if(i&&s.label<i[2]){s.label=i[2],s.ops.push(u);break}i[2]&&s.ops.pop(),s.trys.pop();continue}u=n.call(t,s)}catch(a){u=[6,a],o=0}finally{e=i=0}if(5&u[0])throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}([u,a])}}}var r,f,d,p=e("wj3C"),h=e.n(p),l={AVAILABLE_IN_WINDOW:"only-available-in-window",AVAILABLE_IN_SW:"only-available-in-sw",SHOULD_BE_INHERITED:"should-be-overriden",BAD_SENDER_ID:"bad-sender-id",INCORRECT_GCM_SENDER_ID:"incorrect-gcm-sender-id",PERMISSION_DEFAULT:"permission-default",PERMISSION_BLOCKED:"permission-blocked",UNSUPPORTED_BROWSER:"unsupported-browser",NOTIFICATIONS_BLOCKED:"notifications-blocked",FAILED_DEFAULT_REGISTRATION:"failed-serviceworker-registration",SW_REGISTRATION_EXPECTED:"sw-registration-expected",GET_SUBSCRIPTION_FAILED:"get-subscription-failed",INVALID_SAVED_TOKEN:"invalid-saved-token",SW_REG_REDUNDANT:"sw-reg-redundant",TOKEN_SUBSCRIBE_FAILED:"token-subscribe-failed",TOKEN_SUBSCRIBE_NO_TOKEN:"token-subscribe-no-token",TOKEN_SUBSCRIBE_NO_PUSH_SET:"token-subscribe-no-push-set",TOKEN_UNSUBSCRIBE_FAILED:"token-unsubscribe-failed",TOKEN_UPDATE_FAILED:"token-update-failed",TOKEN_UPDATE_NO_TOKEN:"token-update-no-token",USE_SW_BEFORE_GET_TOKEN:"use-sw-before-get-token",INVALID_DELETE_TOKEN:"invalid-delete-token",DELETE_TOKEN_NOT_FOUND:"delete-token-not-found",DELETE_SCOPE_NOT_FOUND:"delete-scope-not-found",BG_HANDLER_FUNCTION_EXPECTED:"bg-handler-function-expected",NO_WINDOW_CLIENT_TO_MSG:"no-window-client-to-msg",UNABLE_TO_RESUBSCRIBE:"unable-to-resubscribe",NO_FCM_TOKEN_FOR_RESUBSCRIBE:"no-fcm-token-for-resubscribe",FAILED_TO_DELETE_TOKEN:"failed-to-delete-token",NO_SW_IN_REG:"no-sw-in-reg",BAD_SCOPE:"bad-scope",BAD_VAPID_KEY:"bad-vapid-key",BAD_SUBSCRIPTION:"bad-subscription",BAD_TOKEN:"bad-token",BAD_PUSH_SET:"bad-push-set",FAILED_DELETE_VAPID_KEY:"failed-delete-vapid-key",INVALID_PUBLIC_VAPID_KEY:"invalid-public-vapid-key",USE_PUBLIC_KEY_BEFORE_GET_TOKEN:"use-public-key-before-get-token",PUBLIC_KEY_DECRYPTION_FAILED:"public-vapid-key-decryption-failed"},_=((r={})[l.AVAILABLE_IN_WINDOW]="This method is available in a Window context.",r[l.AVAILABLE_IN_SW]="This method is available in a service worker context.",r[l.SHOULD_BE_INHERITED]="This method should be overriden by extended classes.",r[l.BAD_SENDER_ID]="Please ensure that 'messagingSenderId' is set correctly in the options passed into firebase.initializeApp().",r[l.PERMISSION_DEFAULT]="The required permissions were not granted and dismissed instead.",r[l.PERMISSION_BLOCKED]="The required permissions were not granted and blocked instead.",r[l.UNSUPPORTED_BROWSER]="This browser doesn't support the API's required to use the firebase SDK.",r[l.NOTIFICATIONS_BLOCKED]="Notifications have been blocked.",r[l.FAILED_DEFAULT_REGISTRATION]="We are unable to register the default service worker. {$browserErrorMessage}",r[l.SW_REGISTRATION_EXPECTED]="A service worker registration was the expected input.",r[l.GET_SUBSCRIPTION_FAILED]="There was an error when trying to get any existing Push Subscriptions.",r[l.INVALID_SAVED_TOKEN]="Unable to access details of the saved token.",r[l.SW_REG_REDUNDANT]="The service worker being used for push was made redundant.",r[l.TOKEN_SUBSCRIBE_FAILED]="A problem occured while subscribing the user to FCM: {$message}",r[l.TOKEN_SUBSCRIBE_NO_TOKEN]="FCM returned no token when subscribing the user to push.",r[l.TOKEN_SUBSCRIBE_NO_PUSH_SET]="FCM returned an invalid response when getting an FCM token.",r[l.TOKEN_UNSUBSCRIBE_FAILED]="A problem occured while unsubscribing the user from FCM: {$message}",r[l.TOKEN_UPDATE_FAILED]="A problem occured while updating the user from FCM: {$message}",r[l.TOKEN_UPDATE_NO_TOKEN]="FCM returned no token when updating the user to push.",r[l.USE_SW_BEFORE_GET_TOKEN]="The useServiceWorker() method may only be called once and must be called before calling getToken() to ensure your service worker is used.",r[l.INVALID_DELETE_TOKEN]="You must pass a valid token into deleteToken(), i.e. the token from getToken().",r[l.DELETE_TOKEN_NOT_FOUND]="The deletion attempt for token could not be performed as the token was not found.",r[l.DELETE_SCOPE_NOT_FOUND]="The deletion attempt for service worker scope could not be performed as the scope was not found.",r[l.BG_HANDLER_FUNCTION_EXPECTED]="The input to setBackgroundMessageHandler() must be a function.",r[l.NO_WINDOW_CLIENT_TO_MSG]="An attempt was made to message a non-existant window client.",r[l.UNABLE_TO_RESUBSCRIBE]="There was an error while re-subscribing the FCM token for push messaging. Will have to resubscribe the user on next visit. {$message}",r[l.NO_FCM_TOKEN_FOR_RESUBSCRIBE]="Could not find an FCM token and as a result, unable to resubscribe. Will have to resubscribe the user on next visit.",r[l.FAILED_TO_DELETE_TOKEN]="Unable to delete the currently saved token.",r[l.NO_SW_IN_REG]="Even though the service worker registration was successful, there was a problem accessing the service worker itself.",r[l.INCORRECT_GCM_SENDER_ID]="Please change your web app manifest's 'gcm_sender_id' value to '103953800507' to use Firebase messaging.",r[l.BAD_SCOPE]="The service worker scope must be a string with at least one character.",r[l.BAD_VAPID_KEY]="The public VAPID key is not a Uint8Array with 65 bytes.",r[l.BAD_SUBSCRIPTION]="The subscription must be a valid PushSubscription.",r[l.BAD_TOKEN]="The FCM Token used for storage / lookup was not a valid token string.",r[l.BAD_PUSH_SET]="The FCM push set used for storage / lookup was not not a valid push set string.",r[l.FAILED_DELETE_VAPID_KEY]="The VAPID key could not be deleted.",r[l.INVALID_PUBLIC_VAPID_KEY]="The public VAPID key must be a string.",r[l.PUBLIC_KEY_DECRYPTION_FAILED]="The public VAPID key did not equal 65 bytes when decrypted.",r),T=new o.ErrorFactory("messaging","Messaging",_),E=new Uint8Array([4,51,148,247,223,161,235,177,220,3,162,94,21,113,219,72,211,46,237,237,178,52,219,183,71,58,12,143,196,204,225,111,60,140,132,223,171,182,102,62,242,12,212,139,254,227,249,118,47,20,28,99,8,106,111,45,177,26,149,176,206,55,192,156,110]),b="https://fcm.googleapis.com";function S(t,n){if(null==t||null==n)return!1;if(t===n)return!0;if(t.byteLength!==n.byteLength)return!1;for(var e=new DataView(t),o=new DataView(n),i=0;i<t.byteLength;i++)if(e.getUint8(i)!==o.getUint8(i))return!1;return!0}function I(t){return function(t){var n=new Uint8Array(t);return btoa(String.fromCharCode.apply(null,n))}(t).replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_")}!function(t){t.TYPE_OF_MSG="firebase-messaging-msg-type",t.DATA="firebase-messaging-msg-data"}(f||(f={})),function(t){t.PUSH_MSG_RECEIVED="push-msg-received",t.NOTIFICATION_CLICKED="notification-clicked"}(d||(d={}));var w=function(){function t(){}return t.prototype.getToken=function(t,n,e){return a(this,void 0,void 0,function(){var o,i,u,s,a,r,f;return c(this,function(c){switch(c.label){case 0:o=I(n.getKey("p256dh")),i=I(n.getKey("auth")),u="authorized_entity="+t+"&endpoint="+n.endpoint+"&encryption_key="+o+"&encryption_auth="+i,S(e.buffer,E.buffer)||(s=I(e),u+="&application_pub_key="+s),(a=new Headers).append("Content-Type","application/x-www-form-urlencoded"),r={method:"POST",headers:a,body:u},c.label=1;case 1:return c.trys.push([1,4,,5]),[4,fetch(b+"/fcm/connect/subscribe",r)];case 2:return[4,c.sent().json()];case 3:return f=c.sent(),[3,5];case 4:throw c.sent(),T.create(l.TOKEN_SUBSCRIBE_FAILED);case 5:if(f.error)throw T.create(l.TOKEN_SUBSCRIBE_FAILED,{message:f.error.message});if(!f.token)throw T.create(l.TOKEN_SUBSCRIBE_NO_TOKEN);if(!f.pushSet)throw T.create(l.TOKEN_SUBSCRIBE_NO_PUSH_SET);return[2,{token:f.token,pushSet:f.pushSet}]}})})},t.prototype.updateToken=function(t,n,e,o,i){return a(this,void 0,void 0,function(){var u,s,a,r,f,d,p;return c(this,function(c){switch(c.label){case 0:u=I(o.getKey("p256dh")),s=I(o.getKey("auth")),a="push_set="+e+"&token="+n+"&authorized_entity="+t+"&endpoint="+o.endpoint+"&encryption_key="+u+"&encryption_auth="+s,S(i.buffer,E.buffer)||(r=I(i),a+="&application_pub_key="+r),(f=new Headers).append("Content-Type","application/x-www-form-urlencoded"),d={method:"POST",headers:f,body:a},c.label=1;case 1:return c.trys.push([1,4,,5]),[4,fetch(b+"/fcm/connect/subscribe",d)];case 2:return[4,c.sent().json()];case 3:return p=c.sent(),[3,5];case 4:throw c.sent(),T.create(l.TOKEN_UPDATE_FAILED);case 5:if(p.error)throw T.create(l.TOKEN_UPDATE_FAILED,{message:p.error.message});if(!p.token)throw T.create(l.TOKEN_UPDATE_NO_TOKEN);return[2,p.token]}})})},t.prototype.deleteToken=function(t,n,e){return a(this,void 0,void 0,function(){var o,i,u,s;return c(this,function(a){switch(a.label){case 0:o="authorized_entity="+t+"&token="+n+"&pushSet="+e,(i=new Headers).append("Content-Type","application/x-www-form-urlencoded"),u={method:"POST",headers:i,body:o},a.label=1;case 1:return a.trys.push([1,4,,5]),[4,fetch(b+"/fcm/connect/unsubscribe",u)];case 2:return[4,a.sent().json()];case 3:if((s=a.sent()).error)throw T.create(l.TOKEN_UNSUBSCRIBE_FAILED,{message:s.error.message});return[3,5];case 4:throw a.sent(),T.create(l.TOKEN_UNSUBSCRIBE_FAILED);case 5:return[2]}})})},t}();function N(t){for(var n=(t+"=".repeat((4-t.length%4)%4)).replace(/\-/g,"+").replace(/_/g,"/"),e=atob(n),o=new Uint8Array(e.length),i=0;i<e.length;++i)o[i]=e.charCodeAt(i);return o}var m=function(){function t(){this.dbPromise=null}return t.prototype.get=function(t){return this.createTransaction(function(n){return n.get(t)})},t.prototype.getIndex=function(t,n){return this.createTransaction(function(e){return e.index(t).get(n)})},t.prototype.put=function(t){return this.createTransaction(function(n){return n.put(t)},"readwrite")},t.prototype.delete=function(t){return this.createTransaction(function(n){return n.delete(t)},"readwrite")},t.prototype.closeDatabase=function(){return a(this,void 0,void 0,function(){return c(this,function(t){switch(t.label){case 0:return this.dbPromise?[4,this.dbPromise]:[3,2];case 1:t.sent().close(),this.dbPromise=null,t.label=2;case 2:return[2]}})})},t.prototype.createTransaction=function(t,n){return void 0===n&&(n="readonly"),a(this,void 0,void 0,function(){var e,o,i,u;return c(this,function(s){switch(s.label){case 0:return[4,this.getDb()];case 1:return e=s.sent(),o=e.transaction(this.objectStoreName,n),i=o.objectStore(this.objectStoreName),[4,D(t(i))];case 2:return u=s.sent(),[2,new Promise(function(t,n){o.oncomplete=function(){t(u)},o.onerror=function(){n(o.error)}})]}})})},t.prototype.getDb=function(){var t=this;return this.dbPromise||(this.dbPromise=new Promise(function(n,e){var o=indexedDB.open(t.dbName,t.dbVersion);o.onsuccess=function(){n(o.result)},o.onerror=function(){t.dbPromise=null,e(o.error)},o.onupgradeneeded=function(n){return t.onDbUpgrade(o,n)}})),this.dbPromise},t}();function D(t){return new Promise(function(n,e){t.onsuccess=function(){n(t.result)},t.onerror=function(){e(t.error)}})}var y=function(t){function n(){var n=null!==t&&t.apply(this,arguments)||this;return n.dbName="fcm_token_details_db",n.dbVersion=3,n.objectStoreName="fcm_token_object_Store",n}return u(n,t),n.prototype.onDbUpgrade=function(t,n){var e=t.result;switch(n.oldVersion){case 0:(o=e.createObjectStore(this.objectStoreName,{keyPath:"swScope"})).createIndex("fcmSenderId","fcmSenderId",{unique:!1}),o.createIndex("fcmToken","fcmToken",{unique:!0});case 1:!function(){var t=indexedDB.open("undefined");t.onerror=function(t){},t.onsuccess=function(n){!function(t){if(t.objectStoreNames.contains("fcm_token_object_Store")){var n=t.transaction("fcm_token_object_Store").objectStore("fcm_token_object_Store"),e=new w,o=n.openCursor();o.onerror=function(t){console.warn("Unable to cleanup old IDB.",t)},o.onsuccess=function(){var n=o.result;if(n){var i=n.value;e.deleteToken(i.fcmSenderId,i.fcmToken,i.fcmPushSet),n.continue()}else t.close(),indexedDB.deleteDatabase("undefined")}}}(t.result)}}();case 2:var o,i=(o=t.transaction.objectStore(this.objectStoreName)).openCursor();i.onsuccess=function(){var t=i.result;if(t){var n=t.value,e=s({},n);n.createTime||(e.createTime=Date.now()),"string"==typeof n.vapidKey&&(e.vapidKey=N(n.vapidKey)),"string"==typeof n.auth&&(e.auth=N(n.auth).buffer),"string"==typeof n.auth&&(e.p256dh=N(n.p256dh).buffer),t.update(e),t.continue()}}}},n.prototype.getTokenDetailsFromToken=function(t){return a(this,void 0,void 0,function(){return c(this,function(n){if(!t)throw T.create(l.BAD_TOKEN);return A({fcmToken:t}),[2,this.getIndex("fcmToken",t)]})})},n.prototype.getTokenDetailsFromSWScope=function(t){return a(this,void 0,void 0,function(){return c(this,function(n){if(!t)throw T.create(l.BAD_SCOPE);return A({swScope:t}),[2,this.get(t)]})})},n.prototype.saveTokenDetails=function(t){return a(this,void 0,void 0,function(){return c(this,function(n){if(!t.swScope)throw T.create(l.BAD_SCOPE);if(!t.vapidKey)throw T.create(l.BAD_VAPID_KEY);if(!t.endpoint||!t.auth||!t.p256dh)throw T.create(l.BAD_SUBSCRIPTION);if(!t.fcmSenderId)throw T.create(l.BAD_SENDER_ID);if(!t.fcmToken)throw T.create(l.BAD_TOKEN);if(!t.fcmPushSet)throw T.create(l.BAD_PUSH_SET);return A(t),[2,this.put(t)]})})},n.prototype.deleteToken=function(t){return a(this,void 0,void 0,function(){var n;return c(this,function(e){switch(e.label){case 0:return"string"!=typeof t||0===t.length?[2,Promise.reject(T.create(l.INVALID_DELETE_TOKEN))]:[4,this.getTokenDetailsFromToken(t)];case 1:if(!(n=e.sent()))throw T.create(l.DELETE_TOKEN_NOT_FOUND);return[4,this.delete(n.swScope)];case 2:return e.sent(),[2,n]}})})},n}(m);function A(t){if(t.fcmToken&&("string"!=typeof t.fcmToken||0===t.fcmToken.length))throw T.create(l.BAD_TOKEN);if(t.swScope&&("string"!=typeof t.swScope||0===t.swScope.length))throw T.create(l.BAD_SCOPE);if(t.vapidKey&&(!(t.vapidKey instanceof Uint8Array)||65!==t.vapidKey.length))throw T.create(l.BAD_VAPID_KEY);if(t.endpoint&&("string"!=typeof t.endpoint||0===t.endpoint.length))throw T.create(l.BAD_SUBSCRIPTION);if(t.auth&&!(t.auth instanceof ArrayBuffer))throw T.create(l.BAD_SUBSCRIPTION);if(t.p256dh&&!(t.p256dh instanceof ArrayBuffer))throw T.create(l.BAD_SUBSCRIPTION);if(t.fcmSenderId&&("string"!=typeof t.fcmSenderId||0===t.fcmSenderId.length))throw T.create(l.BAD_SENDER_ID);if(t.fcmPushSet&&("string"!=typeof t.fcmPushSet||0===t.fcmPushSet.length))throw T.create(l.BAD_PUSH_SET)}var P=function(t){function n(){var n=null!==t&&t.apply(this,arguments)||this;return n.dbName="fcm_vapid_details_db",n.dbVersion=1,n.objectStoreName="fcm_vapid_object_Store",n}return u(n,t),n.prototype.onDbUpgrade=function(t){t.result.createObjectStore(this.objectStoreName,{keyPath:"swScope"})},n.prototype.getVapidFromSWScope=function(t){return a(this,void 0,void 0,function(){var n;return c(this,function(e){switch(e.label){case 0:if("string"!=typeof t||0===t.length)throw T.create(l.BAD_SCOPE);return[4,this.get(t)];case 1:return[2,(n=e.sent())?n.vapidKey:void 0]}})})},n.prototype.saveVapidDetails=function(t,n){return a(this,void 0,void 0,function(){return c(this,function(e){if("string"!=typeof t||0===t.length)throw T.create(l.BAD_SCOPE);if(null===n||65!==n.length)throw T.create(l.BAD_VAPID_KEY);return[2,this.put({swScope:t,vapidKey:n})]})})},n.prototype.deleteVapidDetails=function(t){return a(this,void 0,void 0,function(){var n;return c(this,function(e){switch(e.label){case 0:return[4,this.getVapidFromSWScope(t)];case 1:if(!(n=e.sent()))throw T.create(l.DELETE_SCOPE_NOT_FOUND);return[4,this.delete(t)];case 2:return e.sent(),[2,n]}})})},n}(m),O="messagingSenderId",B=function(){function t(t){var n=this;if(!t.options[O]||"string"!=typeof t.options[O])throw T.create(l.BAD_SENDER_ID);this.messagingSenderId=t.options[O],this.tokenDetailsModel=new y,this.vapidDetailsModel=new P,this.iidModel=new w,this.app=t,this.INTERNAL={delete:function(){return n.delete()}}}return t.prototype.getToken=function(){return a(this,void 0,void 0,function(){var t,n,e,o,i;return c(this,function(u){switch(u.label){case 0:if("denied"===(t=this.getNotificationPermission_()))throw T.create(l.NOTIFICATIONS_BLOCKED);return"granted"!==t?[2,null]:[4,this.getSWRegistration_()];case 1:return n=u.sent(),[4,this.getPublicVapidKey_()];case 2:return e=u.sent(),[4,this.getPushSubscription(n,e)];case 3:return o=u.sent(),[4,this.tokenDetailsModel.getTokenDetailsFromSWScope(n.scope)];case 4:return(i=u.sent())?[2,this.manageExistingToken(n,o,e,i)]:[2,this.getNewToken(n,o,e)]}})})},t.prototype.manageExistingToken=function(t,n,e,o){return a(this,void 0,void 0,function(){return c(this,function(i){switch(i.label){case 0:return function(t,n,e){if(!e.vapidKey||!S(n.buffer,e.vapidKey.buffer))return!1;var o=t.endpoint===e.endpoint,i=S(t.getKey("auth"),e.auth),u=S(t.getKey("p256dh"),e.p256dh);return o&&i&&u}(n,e,o)?Date.now()<o.createTime+6048e5?[2,o.fcmToken]:[2,this.updateToken(t,n,e,o)]:[4,this.deleteTokenFromDB(o.fcmToken)];case 1:return i.sent(),[2,this.getNewToken(t,n,e)]}})})},t.prototype.updateToken=function(t,n,e,o){return a(this,void 0,void 0,function(){var i,u,s;return c(this,function(a){switch(a.label){case 0:return a.trys.push([0,4,,6]),[4,this.iidModel.updateToken(this.messagingSenderId,o.fcmToken,o.fcmPushSet,n,e)];case 1:return i=a.sent(),u={swScope:t.scope,vapidKey:e,fcmSenderId:this.messagingSenderId,fcmToken:i,fcmPushSet:o.fcmPushSet,createTime:Date.now(),endpoint:n.endpoint,auth:n.getKey("auth"),p256dh:n.getKey("p256dh")},[4,this.tokenDetailsModel.saveTokenDetails(u)];case 2:return a.sent(),[4,this.vapidDetailsModel.saveVapidDetails(t.scope,e)];case 3:return a.sent(),[2,i];case 4:return s=a.sent(),[4,this.deleteToken(o.fcmToken)];case 5:throw a.sent(),s;case 6:return[2]}})})},t.prototype.getNewToken=function(t,n,e){return a(this,void 0,void 0,function(){var o,i;return c(this,function(u){switch(u.label){case 0:return[4,this.iidModel.getToken(this.messagingSenderId,n,e)];case 1:return o=u.sent(),i={swScope:t.scope,vapidKey:e,fcmSenderId:this.messagingSenderId,fcmToken:o.token,fcmPushSet:o.pushSet,createTime:Date.now(),endpoint:n.endpoint,auth:n.getKey("auth"),p256dh:n.getKey("p256dh")},[4,this.tokenDetailsModel.saveTokenDetails(i)];case 2:return u.sent(),[4,this.vapidDetailsModel.saveVapidDetails(t.scope,e)];case 3:return u.sent(),[2,o.token]}})})},t.prototype.deleteToken=function(t){return a(this,void 0,void 0,function(){var n,e;return c(this,function(o){switch(o.label){case 0:return[4,this.deleteTokenFromDB(t)];case 1:return o.sent(),[4,this.getSWRegistration_()];case 2:return(n=o.sent())?[4,n.pushManager.getSubscription()]:[3,4];case 3:if(e=o.sent())return[2,e.unsubscribe()];o.label=4;case 4:return[2,!0]}})})},t.prototype.deleteTokenFromDB=function(t){return a(this,void 0,void 0,function(){var n;return c(this,function(e){switch(e.label){case 0:return[4,this.tokenDetailsModel.deleteToken(t)];case 1:return n=e.sent(),[4,this.iidModel.deleteToken(n.fcmSenderId,n.fcmToken,n.fcmPushSet)];case 2:return e.sent(),[2]}})})},t.prototype.getPushSubscription=function(t,n){return t.pushManager.getSubscription().then(function(e){return e||t.pushManager.subscribe({userVisibleOnly:!0,applicationServerKey:n})})},t.prototype.requestPermission=function(){throw T.create(l.AVAILABLE_IN_WINDOW)},t.prototype.useServiceWorker=function(t){throw T.create(l.AVAILABLE_IN_WINDOW)},t.prototype.usePublicVapidKey=function(t){throw T.create(l.AVAILABLE_IN_WINDOW)},t.prototype.onMessage=function(t,n,e){throw T.create(l.AVAILABLE_IN_WINDOW)},t.prototype.onTokenRefresh=function(t,n,e){throw T.create(l.AVAILABLE_IN_WINDOW)},t.prototype.setBackgroundMessageHandler=function(t){throw T.create(l.AVAILABLE_IN_SW)},t.prototype.delete=function(){return a(this,void 0,void 0,function(){return c(this,function(t){switch(t.label){case 0:return[4,Promise.all([this.tokenDetailsModel.closeDatabase(),this.vapidDetailsModel.closeDatabase()])];case 1:return t.sent(),[2]}})})},t.prototype.getNotificationPermission_=function(){return Notification.permission},t.prototype.getTokenDetailsModel=function(){return this.tokenDetailsModel},t.prototype.getVapidDetailsModel=function(){return this.vapidDetailsModel},t.prototype.getIidModel=function(){return this.iidModel},t}(),g=function(t){function n(n){var e=t.call(this,n)||this;return e.bgMessageHandler=null,self.addEventListener("push",function(t){e.onPush(t)}),self.addEventListener("pushsubscriptionchange",function(t){e.onSubChange(t)}),self.addEventListener("notificationclick",function(t){e.onNotificationClick(t)}),e}return u(n,t),n.prototype.onPush=function(t){t.waitUntil(this.onPush_(t))},n.prototype.onSubChange=function(t){t.waitUntil(this.onSubChange_(t))},n.prototype.onNotificationClick=function(t){t.waitUntil(this.onNotificationClick_(t))},n.prototype.onPush_=function(t){return a(this,void 0,void 0,function(){var n,e,o,i,u,s;return c(this,function(a){switch(a.label){case 0:if(!t.data)return[2];try{n=t.data.json()}catch(c){return[2]}return[4,this.hasVisibleClients_()];case 1:return a.sent()?[2,this.sendMessageToWindowClients_(n)]:(e=this.getNotificationData_(n))?(o=e.title||"",[4,this.getSWRegistration_()]):[3,3];case 2:return i=a.sent(),u=e.actions,s=Notification.maxActions,u&&s&&u.length>s&&console.warn("This browser only supports "+s+" actions.The remaining actions will not be displayed."),[2,i.showNotification(o,e)];case 3:return this.bgMessageHandler?[4,this.bgMessageHandler(n)]:[3,5];case 4:return a.sent(),[2];case 5:return[2]}})})},n.prototype.onSubChange_=function(t){return a(this,void 0,void 0,function(){var t,n,e,o;return c(this,function(i){switch(i.label){case 0:return i.trys.push([0,2,,3]),[4,this.getSWRegistration_()];case 1:return t=i.sent(),[3,3];case 2:throw n=i.sent(),T.create(l.UNABLE_TO_RESUBSCRIBE,{message:n});case 3:return i.trys.push([3,5,,8]),[4,t.pushManager.getSubscription()];case 4:return i.sent(),[3,8];case 5:return e=i.sent(),[4,this.getTokenDetailsModel().getTokenDetailsFromSWScope(t.scope)];case 6:if(!(o=i.sent()))throw e;return[4,this.deleteToken(o.fcmToken)];case 7:throw i.sent(),e;case 8:return[2]}})})},n.prototype.onNotificationClick_=function(t){return a(this,void 0,void 0,function(){var n,e,o,i;return c(this,function(u){switch(u.label){case 0:return t.notification&&t.notification.data&&t.notification.data.FCM_MSG?t.action?[2]:(t.stopImmediatePropagation(),t.notification.close(),(n=t.notification.data.FCM_MSG).notification&&(e=n.fcmOptions&&n.fcmOptions.link||n.notification.click_action)?[4,this.getWindowClient_(e)]:[2]):[2];case 1:return(o=u.sent())?[3,3]:[4,self.clients.openWindow(e)];case 2:return o=u.sent(),[3,5];case 3:return[4,o.focus()];case 4:o=u.sent(),u.label=5;case 5:return o?(delete n.notification,delete n.fcmOptions,i=K(d.NOTIFICATION_CLICKED,n),[2,this.attemptToMessageClient_(o,i)]):[2]}})})},n.prototype.getNotificationData_=function(t){if(t&&"object"==typeof t.notification){var n,e=s({},t.notification);return e.data=s({},t.notification.data,((n={}).FCM_MSG=t,n)),e}},n.prototype.setBackgroundMessageHandler=function(t){if(!t||"function"!=typeof t)throw T.create(l.BG_HANDLER_FUNCTION_EXPECTED);this.bgMessageHandler=t},n.prototype.getWindowClient_=function(t){return a(this,void 0,void 0,function(){var n,e,o,i;return c(this,function(u){switch(u.label){case 0:return n=new URL(t,self.location.href).href,[4,U()];case 1:for(e=u.sent(),o=null,i=0;i<e.length;i++)if(new URL(e[i].url,self.location.href).href===n){o=e[i];break}return[2,o]}})})},n.prototype.attemptToMessageClient_=function(t,n){return a(this,void 0,void 0,function(){return c(this,function(e){if(!t)throw T.create(l.NO_WINDOW_CLIENT_TO_MSG);return t.postMessage(n),[2]})})},n.prototype.hasVisibleClients_=function(){return a(this,void 0,void 0,function(){return c(this,function(t){switch(t.label){case 0:return[4,U()];case 1:return[2,t.sent().some(function(t){return"visible"===t.visibilityState})]}})})},n.prototype.sendMessageToWindowClients_=function(t){return a(this,void 0,void 0,function(){var n,e,o=this;return c(this,function(i){switch(i.label){case 0:return[4,U()];case 1:return n=i.sent(),e=K(d.PUSH_MSG_RECEIVED,t),[4,Promise.all(n.map(function(t){return o.attemptToMessageClient_(t,e)}))];case 2:return i.sent(),[2]}})})},n.prototype.getSWRegistration_=function(){return a(this,void 0,void 0,function(){return c(this,function(t){return[2,self.registration]})})},n.prototype.getPublicVapidKey_=function(){return a(this,void 0,void 0,function(){var t,n;return c(this,function(e){switch(e.label){case 0:return[4,this.getSWRegistration_()];case 1:if(!(t=e.sent()))throw T.create(l.SW_REGISTRATION_EXPECTED);return[4,this.getVapidDetailsModel().getVapidFromSWScope(t.scope)];case 2:return null==(n=e.sent())?[2,E]:[2,n]}})})},n}(B);function U(){return self.clients.matchAll({type:"window",includeUncontrolled:!0})}function K(t,n){return(e={})[f.TYPE_OF_MSG]=t,e[f.DATA]=n,e;var e}var M=function(t){function n(n){var e=t.call(this,n)||this;return e.registrationToUse=null,e.publicVapidKeyToUse=null,e.manifestCheckPromise=null,e.messageObserver=null,e.tokenRefreshObserver=null,e.onMessageInternal=Object(o.createSubscribe)(function(t){e.messageObserver=t}),e.onTokenRefreshInternal=Object(o.createSubscribe)(function(t){e.tokenRefreshObserver=t}),e.setupSWMessageListener_(),e}return u(n,t),n.prototype.getToken=function(){return a(this,void 0,void 0,function(){return c(this,function(n){switch(n.label){case 0:return this.manifestCheckPromise||(this.manifestCheckPromise=function(){return a(this,void 0,void 0,function(){var t,n;return c(this,function(e){switch(e.label){case 0:if(!(t=document.querySelector('link[rel="manifest"]')))return[2];e.label=1;case 1:return e.trys.push([1,4,,5]),[4,fetch(t.href)];case 2:return[4,e.sent().json()];case 3:return n=e.sent(),[3,5];case 4:return e.sent(),[2];case 5:if(!n||!n.gcm_sender_id)return[2];if("103953800507"!==n.gcm_sender_id)throw T.create(l.INCORRECT_GCM_SENDER_ID);return[2]}})})}()),[4,this.manifestCheckPromise];case 1:return n.sent(),[2,t.prototype.getToken.call(this)]}})})},n.prototype.requestPermission=function(){return a(this,void 0,void 0,function(){var t;return c(this,function(n){switch(n.label){case 0:return"granted"===this.getNotificationPermission_()?[2]:[4,Notification.requestPermission()];case 1:if("granted"===(t=n.sent()))return[2];throw T.create("denied"===t?l.PERMISSION_BLOCKED:l.PERMISSION_DEFAULT)}})})},n.prototype.useServiceWorker=function(t){if(!(t instanceof ServiceWorkerRegistration))throw T.create(l.SW_REGISTRATION_EXPECTED);if(null!=this.registrationToUse)throw T.create(l.USE_SW_BEFORE_GET_TOKEN);this.registrationToUse=t},n.prototype.usePublicVapidKey=function(t){if("string"!=typeof t)throw T.create(l.INVALID_PUBLIC_VAPID_KEY);if(null!=this.publicVapidKeyToUse)throw T.create(l.USE_PUBLIC_KEY_BEFORE_GET_TOKEN);var n=N(t);if(65!==n.length)throw T.create(l.PUBLIC_KEY_DECRYPTION_FAILED);this.publicVapidKeyToUse=n},n.prototype.onMessage=function(t,n,e){return"function"==typeof t?this.onMessageInternal(t,n,e):this.onMessageInternal(t)},n.prototype.onTokenRefresh=function(t,n,e){return"function"==typeof t?this.onTokenRefreshInternal(t,n,e):this.onTokenRefreshInternal(t)},n.prototype.waitForRegistrationToActivate_=function(t){var n=t.installing||t.waiting||t.active;return new Promise(function(e,o){if(n)if("activated"!==n.state)if("redundant"!==n.state){var i=function(){if("activated"===n.state)e(t);else{if("redundant"!==n.state)return;o(T.create(l.SW_REG_REDUNDANT))}n.removeEventListener("statechange",i)};n.addEventListener("statechange",i)}else o(T.create(l.SW_REG_REDUNDANT));else e(t);else o(T.create(l.NO_SW_IN_REG))})},n.prototype.getSWRegistration_=function(){var t=this;return this.registrationToUse?this.waitForRegistrationToActivate_(this.registrationToUse):(this.registrationToUse=null,navigator.serviceWorker.register("/firebase-messaging-sw.js",{scope:"/firebase-cloud-messaging-push-scope"}).catch(function(t){throw T.create(l.FAILED_DEFAULT_REGISTRATION,{browserErrorMessage:t.message})}).then(function(n){return t.waitForRegistrationToActivate_(n).then(function(){return t.registrationToUse=n,n.update(),n})}))},n.prototype.getPublicVapidKey_=function(){return a(this,void 0,void 0,function(){return c(this,function(t){return this.publicVapidKeyToUse?[2,this.publicVapidKeyToUse]:[2,E]})})},n.prototype.setupSWMessageListener_=function(){var t=this;navigator.serviceWorker.addEventListener("message",function(n){if(n.data&&n.data[f.TYPE_OF_MSG]){var e=n.data;switch(e[f.TYPE_OF_MSG]){case d.PUSH_MSG_RECEIVED:case d.NOTIFICATION_CLICKED:t.messageObserver&&t.messageObserver.next(e[f.DATA])}}},!1)},n}(B);function V(){return self&&"ServiceWorkerGlobalScope"in self?"PushManager"in self&&"Notification"in self&&ServiceWorkerRegistration.prototype.hasOwnProperty("showNotification")&&PushSubscription.prototype.hasOwnProperty("getKey"):navigator.cookieEnabled&&"serviceWorker"in navigator&&"PushManager"in window&&"Notification"in window&&"fetch"in window&&ServiceWorkerRegistration.prototype.hasOwnProperty("showNotification")&&PushSubscription.prototype.hasOwnProperty("getKey")}h.a.INTERNAL.registerService("messaging",function(t){if(!V())throw T.create(l.UNSUPPORTED_BROWSER);return self&&"ServiceWorkerGlobalScope"in self?new g(t):new M(t)},{isSupported:V})}}]);